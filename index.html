<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RockClan Records</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'%3E%3Crect width='128' height='128' rx='24' fill='%23222236'/%3E%3Cpath d='M82 30 56 64l26 34-18 0-26-34 26-34z' fill='%23ff6a00'/%3E%3C/svg%3E">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
  <style>
    :root{ --bg1:#0b0710;--bg2:#14050a;--accent:#ff6a00;--muted:#a7a0a8;--card:rgba(255,255,255,0.03); }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,'Segoe UI',Roboto,'Noto Sans KR','Apple SD Gothic Neo','Malgun Gothic',sans-serif;margin:0;color:#eee;background:linear-gradient(180deg,var(--bg1),var(--bg2));}
    header{padding:20px;text-align:center;background:linear-gradient(90deg,rgba(255,255,255,0.02),rgba(0,0,0,0.06));box-shadow:0 6px 30px rgba(0,0,0,0.5)}
    header h1{margin:0;color:var(--accent)}
    header .sub{color:var(--muted);font-size:13px;margin-top:6px}
    nav{display:flex;gap:10px;justify-content:center;padding:10px;background:#14141a;position:sticky;top:0;z-index:2}
    nav button{background:#1a1a22;border:1px solid #232532;color:#ddd;padding:10px 14px;border-radius:10px;cursor:pointer}
    nav button.active{background:var(--accent);color:#111}
    main{max-width:1100px;margin:18px auto;padding:0 16px}
    section{display:none}
    section.active{display:block}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:inset 0 1px 0 rgba(255,255,255,0.02);margin-bottom:16px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px 10px;border-bottom:1px solid rgba(255,255,255,0.06);text-align:center}
    th{color:var(--muted);font-size:12px;text-transform:uppercase}
    tr:hover{background:rgba(255,255,255,0.03)}
    .tier-Stone{color:#8b8b8b}.tier-Bronze{color:#cd7f32}.tier-Silver{color:#c0c0c0}.tier-Gold{color:#ffd700}.tier-Diamond{color:#67e8f9}.tier-Legend{color:#ff7f50}
    .muted{color:var(--muted)}
    .match{border:1px solid rgba(255,255,255,0.08);padding:10px;border-radius:10px;background:rgba(255,255,255,0.02);margin-bottom:10px;cursor:pointer}
    .details{display:none;margin-top:8px;font-size:14px;color:#ddd}
    .details.active{display:block}
    .filters{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
    .filters > *{flex:1 1 160px}
    .rank-badge{background:#252532;border:1px solid #2f3140;border-radius:8px;padding:2px 8px;font-weight:700;display:inline-block;margin-right:6px}
    .note{font-size:12px;color:#aaa;margin-top:6px}
  </style>
</head>
<script>
window.addEventListener('error', e => {
  console.error('ğŸ”¥ SCRIPT ERROR LOCATION ğŸ”¥', e.filename, 'Line:', e.lineno, 'Col:', e.colno);
});
</script>
<body>
  <header>
    <h1>RockClan Records</h1>
    <div class="sub">í´ëœì› ë­í‚¹ â€¢ ê¸°ë¡ì‹¤ â€¢ ELO ì„¤ëª… â€¢ ë³€ë™ ê·¸ë˜í”„</div>
  </header>

  <nav>
    <button class="tab active" data-tab="players">í´ëœì› ë­í‚¹</button>
    <button class="tab" data-tab="records">ê¸°ë¡ì‹¤</button>
    <button class="tab" data-tab="elo-info">ELO ì‹œìŠ¤í…œ ì„¤ëª…</button>
    <button class="tab" data-tab="chart">ELO ë³€ë™ ê·¸ë˜í”„</button>
  </nav>

  <main>
    <section id="players" class="active">
      <div class="card">
        <h2 style="margin:6px 0;color:var(--accent)">í´ëœì› ë­í‚¹</h2>
        <div class="filters">
          <input id="search" placeholder="id ê²€ìƒ‰" style="padding:10px;border-radius:8px;border:1px solid #2c2f3a;background:#101018;color:#fff">
          <select id="raceFilter" style="padding:10px;border-radius:8px;border:1px solid #2c2f3a;background:#101018;color:#fff">
            <option value="">ì¢…ì¡± ì „ì²´</option><option>Protoss</option><option>Terran</option><option>Zerg</option><option>Random</option>
          </select>
          <select id="tierFilter" style="padding:10px;border-radius:8px;border:1px solid #2c2f3a;background:#101018;color:#fff">
            <option value="">í‹°ì–´ ì „ì²´</option><option>Stone</option><option>Bronze</option><option>Silver</option><option>Gold</option><option>Diamond</option><option>Legend</option>
          </select>
        </div>
        <div class="muted" style="font-size:13px;margin-bottom:6px">ì „ì²´ ì¸ì›, ì¢…ì¡±/í‹°ì–´, í˜„ì¬ ELO, ìŠ¹ë¥ (%) â€” <span id="counts"></span></div>
        <table id="players-table">
          <thead><tr><th>Rank</th><th>ID</><th>ì¢…ì¡±</th><th>í‹°ì–´</th><th>ELO</th><th>ìŠ¹</th><th>íŒ¨</th><th>ìŠ¹ë¥ </th></tr></thead>
          <tbody></tbody>
        </table>
        <div class="note">* ìŠ¹/íŒ¨/ìŠ¹ë¥ ì€ <b>ê¸°ë¡ì‹¤(match)</b>ì„ ê¸°ë°˜ìœ¼ë¡œ ìë™ ì¬ê³„ì‚°ë©ë‹ˆë‹¤.</div>
      </div>
    </section>

    <section id="records">
      <div class="card">
        <h2 style="margin:6px 0;color:var(--accent)">ê¸°ë¡ì‹¤ (í´ë¦­í•˜ì—¬ ì ‘ê¸°/í¼ì¹˜ê¸°)</h2>
        <div id="match-list"></div>
      </div>
    </section>

    <section id="elo-info">
      <div class="card">
        <h2 style="margin:6px 0;color:var(--accent)">ELO ì‹œìŠ¤í…œ ì„¤ëª…</h2>
        <ul>
          <li>ì´ˆê¸° ELO: <b>1000</b></li>
          <li>ê°œì¸ì „ K-ê³„ìˆ˜: <b>24</b> (íŒ€ì „ì€ <b>60%</b> ë°˜ì˜)</li>
          <li>í‹°ì–´ ë³´ì • ê³„ìˆ˜: <code>1 + 0.2 Ã— Î”tierIndex</code></li>
          <li>ë­í‚¹ ì •ë ¬ ê¸°ì¤€: í˜„ì¬ ELO (ìƒë‹¨ â€œí´ëœì› ë­í‚¹â€ í‘œ)</li>
          <li>ìŠ¹/íŒ¨/ìŠ¹ë¥ : ê¸°ë¡ì‹¤ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ì§‘ê³„í•˜ì—¬ í‘œì‹œ</li>
        </ul>

        <div class="muted" style="margin:8px 0 4px">í‹°ì–´ ì¸ë±ìŠ¤ ì˜ˆì‹œ: Stone 0, Bronze 1, Silver 2, Gold 3, Diamond 4, Legend 5</div>
        <table style="width:100%;border-collapse:collapse">
          <thead>
            <tr><th>ë§¤ì¹˜ì—…</th><th>Î”tierIndex</th><th>ë³´ì •ê³„ìˆ˜</th><th>ì´ê²¼ì„ ë•Œ</th><th>ì¡Œì„ ë•Œ</th></tr>
          </thead>
          <tbody>
            <tr><td>ë™ì¼ í‹°ì–´ vs ë™ì¼ í‹°ì–´</td><td>0</td><td>1.0</td><td>ê¸°ë³¸ K=24</td><td>ê¸°ë³¸ K=24</td></tr>
            <tr><td>í•œ ë‹¨ê³„â†‘ vs í•œ ë‹¨ê³„â†“</td><td>+1/-1</td><td>1.2 / 0.8</td><td>ì•„ë«í‹°ì–´ ìŠ¹ë¦¬ í° +</td><td>ìœ—í‹°ì–´ íŒ¨ë°° í° -</td></tr>
            <tr><td>ë‘ ë‹¨ê³„â†‘ vs ë‘ ë‹¨ê³„â†“</td><td>+2/-2</td><td>1.4 / 0.6</td><td>ì–¸ë”ë… í° +</td><td>ê°•ì í° -</td></tr>
            <tr><td>ì„¸ ë‹¨ê³„â†‘ vs ì„¸ ë‹¨ê³„â†“</td><td>+3/-3</td><td>1.6 / 0.4</td><td>ì•„ì£¼ í° +</td><td>ì•„ì£¼ í° -</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <section id="chart">
      <div class="card">
        <h2 style="margin:6px 0;color:var(--accent)">ELO ë³€ë™ ê·¸ë˜í”„</h2>
        <div id="elo-chart" style="width:100%;height:440px"></div>
      </div>
    </section>
  </main>

  <script>
    // Ceta/Chan ì •ê·œí™”(ì „ì—­)
    function normalizeCetaChan(data){
      const rep = n => (n === 'Chann' ? 'Ceta' : n);
      data.matches.forEach(m=>{
        if (m.player1) m.player1 = rep(m.player1);
        if (m.player2) m.player2 = rep(m.player2);
        if (Array.isArray(m.team1)) m.team1 = m.team1.map(rep);
        if (Array.isArray(m.team2)) m.team2 = m.team2.map(rep);
        if (Array.isArray(m.winner)) m.winner = m.winner.map(rep);
        else if (typeof m.winner === 'string') m.winner = rep(m.winner);
      });
      // players ì •ë¦¬
      let channIdx=data.players.findIndex(p=>p.id==='Chann');
      let cetaIdx=data.players.findIndex(p=>p.id==='Ceta');
      if(channIdx!==-1){
        if(cetaIdx===-1){data.players[channIdx].id='Ceta'; cetaIdx=channIdx;}
        else data.players.splice(channIdx,1);
      }
      // í”„ë¡œí•„ ë³´ì •
      let ceta=data.players.find(p=>p.id==='Ceta');
      if(!ceta){ceta={id:'Ceta',race:'Zerg',tier:'Gold',elo:1000,played:0,win:0,loss:0,history:[1000]};data.players.push(ceta);}
      ceta.race='Zerg'; ceta.tier='Gold';
      let chan=data.players.find(p=>p.id==='Chan');
      if(!chan){chan={id:'Chan',race:'Protoss',tier:'Silver',elo:1000,played:0,win:0,loss:0,history:[1000]};data.players.push(chan);}
      chan.race='Protoss'; chan.tier='Silver';
      return data;
    }

    // ë°ì´í„° ìˆ˜ë³µ
    function fixData(data){
      data = normalizeCetaChan(data);
      if(data.players.some(p=>p.id==='Danny')){
        data.matches.forEach(m=>{
          const rep = name => (name==='Danny' ? 'DanielK' : name);
          if(m.player1) m.player1 = rep(m.player1);
          if(m.player2) m.player2 = rep(m.player2);
          if(Array.isArray(m.team1)) m.team1 = m.team1.map(rep);
          if(Array.isArray(m.team2)) m.team2 = m.team2.map(rep);
          if(Array.isArray(m.winner)) m.winner = m.winner.map(rep);
          if(typeof m.winner==='string') m.winner = rep(m.winner);
        });
        data.players = data.players.filter(p=>p.id!=='Danny');
      }
      return data;
    }

    // íƒ­ ì „í™˜
    document.querySelectorAll('nav .tab').forEach(btn=>{
      btn.addEventListener('click', e=>{
        document.querySelectorAll('nav .tab').forEach(b=>b.classList.remove('active'));
        e.currentTarget.classList.add('active');
        document.querySelectorAll('main section').forEach(s=>s.classList.remove('active'));
        document.getElementById(e.currentTarget.dataset.tab).classList.add('active');
      });
    });

    // Matchday ë¬¶ê¸°
    function groupByMatchday(matches){
      const groups=[]; let current=null; let md=0;
      for(const m of matches){
        if(!current || current.date!==m.date || m.map==='Matchday'){
          if(m.map==='Matchday'){ md=current&&current.date===m.date?md+1:1; current={date:m.date,index:md,header:m,sets:[]}; groups.push(current);}
          else{ if(!current || current.date!==m.date){md=1; current={date:m.date,index:md,header:null,sets:[]}; groups.push(current);} }
        }
        if(m.map==='Matchday') current.header=m; else current.sets.push(m);
      }
      return groups;
    }

    // ë°ì´í„° ë¡œë“œ
    fetch('data.json',{cache:'no-cache'}).then(r=>r.json()).then(data=>{
      data = fixData(data);
      const tbody=document.querySelector('#players-table tbody');
      function render(){
        tbody.innerHTML='';
        const sorted=[...data.players].sort((a,b)=>b.elo-a.elo);
        sorted.forEach((p,i)=>{
          const played=p.played||0,win=p.win||0,loss=p.loss||0,wr=played?((win/played)*100).toFixed(1)+'%':'-';
          tbody.innerHTML+=`<tr><td><span class='rank-badge'>${i+1}</span></td><td>${p.id}</td><td>${p.race}</td><td class='tier-${p.tier}'>${p.tier}</td><td>${Math.round(p.elo)}</td><td>${win}</td><td>${loss}</td><td>${wr}</td></tr>`;
        });
        document.getElementById('counts').textContent=`Players: ${data.players.length} | Matches: ${data.matches.length}`;
      }
      render();

      const list=document.getElementById('match-list');
      const groups=groupByMatchday([...data.matches].sort((a,b)=>a.date.localeCompare(b.date)));
      groups.forEach(g=>{
        const box=document.createElement('div'); box.className='match';
        const head=document.createElement('div');
        if(g.header){
          const winners=Array.isArray(g.header.winner)?g.header.winner.join(', '):(g.header.winner||'-');
          const score=g.header.score||'-';
          head.innerHTML=`<b>${g.date}</b> | Matchday | ìŠ¹ì: ${winners} | ìŠ¤ì½”ì–´: ${score}`;
        }else head.innerHTML=`<b>${g.date}</b> | ì„¸íŠ¸ ëª¨ìŒ`;
        const det=document.createElement('div'); det.className='details';
        if(!g.sets||!g.sets.length) det.innerHTML='<div class="muted">ì„¸íŠ¸ ê¸°ë¡ ì—†ìŒ</div>';
        else det.innerHTML=g.sets.map(s=>`<div>${s.map}: ${s.player1||s.team1} vs ${s.player2||s.team2} â€” ìŠ¹ì: ${s.winner||'-'}</div>`).join('');
        box.appendChild(head); box.appendChild(det);
        box.addEventListener('click',()=>det.classList.toggle('active'));
        list.appendChild(box);
      });
    }).catch(e=>console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨',e));
  </script>
</body>
</html>
