<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RockClan Records</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
  <style>
    body{font-family:system-ui,-apple-system,'Noto Sans KR',sans-serif;background:#0b0710;color:#eee;margin:0}
    header{padding:20px;text-align:center;background:#14141a}
    h1{color:#ff6a00;margin:0}
    main{max-width:1100px;margin:20px auto;padding:0 16px}
    .card{background:rgba(255,255,255,0.03);padding:16px;border-radius:12px;margin-bottom:16px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px 10px;border-bottom:1px solid rgba(255,255,255,0.06);text-align:center}
    th{color:#a7a0a8;text-transform:uppercase;font-size:12px}
  </style>
</head>
<body>
  <header>
    <h1>RockClan Records</h1>
    <div>클랜원 랭킹 • 기록실 • ELO 그래프</div>
  </header>
  <main>
    <div class="card">
      <h2 style="margin-top:0">클랜원 랭킹</h2>
      <table id="players"><thead><tr><th>Rank</th><th>ID</th><th>Race</th><th>Tier</th><th>ELO</th><th>W</th><th>L</th><th>WR</th></tr></thead><tbody></tbody></table>
    </div>
    <div class="card">
      <h2 style="margin-top:0">ELO 변동 그래프</h2>
      <div id="chart" style="width:100%;height:360px"></div>
    </div>
  </main>
<script>
fetch('data.json').then(r=>r.json()).then(data=>{
  const tbody = document.querySelector('#players tbody');
  const list = [...data.players].sort((a,b)=> b.elo - a.elo);
  list.forEach((p,i)=>{
    const wr = p.played ? ((p.win/p.played)*100).toFixed(1)+'%' : '-';
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${i+1}</td><td>${p.id}</td><td>${p.race}</td><td>${p.tier}</td><td>${Math.round(p.elo)}</td><td>${p.win||0}</td><td>${p.loss||0}</td><td>${wr}</td>`;
    tbody.appendChild(tr);
  });
  const ids = list.slice(0,8).map(p=>p.id);
  const series = {};
  list.forEach(p=>{
    (p.history||[]).forEach((v,i)=>{
      if(!series[i]) series[i] = { step:i };
      series[i][p.id] = v;
    });
  });
  const chartData = Object.keys(series).sort((a,b)=>a-b).map(k=>series[k]);
  const lines = ids.map((pid,i)=> React.createElement(Recharts.Line, { key:pid, type:'monotone', dataKey:pid, stroke:`hsl(${(i*47)%360} 70% 60%)`, dot:false, strokeWidth:2 }));
  ReactDOM.render(
    React.createElement(Recharts.ResponsiveContainer,{width:'100%',height:320},
      React.createElement(Recharts.LineChart,{data:chartData},
        React.createElement(Recharts.XAxis,{dataKey:'step'}),
        React.createElement(Recharts.YAxis,{}),
        React.createElement(Recharts.Tooltip,{}),
        React.createElement(Recharts.Legend,{}),
        ...lines
      )
    ),
    document.getElementById('chart')
  );
}).catch(err=>{
  console.error(err);
});
</script>
</body>
</html>
